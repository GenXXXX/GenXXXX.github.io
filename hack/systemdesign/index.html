<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="No more knowledge can be extracted from my telling">
<title>
    System Design å­¦ä¹ ä¸Šæ‰‹ - ç™½é©¬ç°é©¬
</title>


<link rel="shortcut icon" href="/sam.ico">








<link rel="stylesheet" href="/css/main.min.c5514d3530979d291f3497facc20da1cec870028dbc2a3630b64bab8721bbe49.css" integrity="sha256-xVFNNTCXnSkfNJf6zCDaHOyHACjbwqNjC2S6uHIbvkk=" crossorigin="anonymous" media="screen">




  






<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="System Design å­¦ä¹ ä¸Šæ‰‹"/>
<meta name="twitter:description" content="æ€»æœ‰ä¸€äº›çŠ€åˆ©çš„å…¬å¸è¯•å›¾ç”¨System Designæ¥è€ƒå¯Ÿnew gradçš„å³æˆ˜åŠ›ï¼Œè¿˜æ˜¯å¾—å‡†å¤‡ä¸€ä¸ªã€‚å…ˆä»¥è®¾è®¡Twitterä¸ºä¾‹ï¼š"/>

<meta property="og:title" content="System Design å­¦ä¹ ä¸Šæ‰‹" />
<meta property="og:description" content="æ€»æœ‰ä¸€äº›çŠ€åˆ©çš„å…¬å¸è¯•å›¾ç”¨System Designæ¥è€ƒå¯Ÿnew gradçš„å³æˆ˜åŠ›ï¼Œè¿˜æ˜¯å¾—å‡†å¤‡ä¸€ä¸ªã€‚å…ˆä»¥è®¾è®¡Twitterä¸ºä¾‹ï¼š" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://GenXXXX.github.io/hack/systemdesign/" /><meta property="article:section" content="hack" />
<meta property="article:published_time" content="2017-12-28T00:14:19-07:00" />
<meta property="article:modified_time" content="2017-12-28T00:14:19-07:00" />



    

    
    
    
    <title>
        
        System Design å­¦ä¹ ä¸Šæ‰‹
        
    </title>
</head>

<body>
    
    
    <header class="wrap flex-container">
        <h1>System Design å­¦ä¹ ä¸Šæ‰‹</h1>
    </header>
    
    <main class="wrap">
        
        <article role="article" class="flex-container"><p>æ€»æœ‰ä¸€äº›çŠ€åˆ©çš„å…¬å¸è¯•å›¾ç”¨System Designæ¥è€ƒå¯Ÿnew gradçš„å³æˆ˜åŠ›ï¼Œè¿˜æ˜¯å¾—å‡†å¤‡ä¸€ä¸ªã€‚å…ˆä»¥è®¾è®¡Twitterä¸ºä¾‹ï¼š</p>
<h2 id="1-requirements-classification" class="anchor-link"><a href="#1-requirements-classification">1. Requirements classification<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<p>é—®æ¸…æ¥šéœ€æ±‚å†å¼€å§‹è®¾è®¡ï¼Œå¸¸è¯†ã€‚é—®é¢˜ä¾‹å¦‚ï¼š</p>
<ul>
<li>Will users of our service be able to post tweets and follow other people?</li>
<li>Should we also design to create and display userâ€™s timeline?</li>
<li>Will tweets contain photos and videos?</li>
<li>Will users be able to search tweets?</li>
<li>Do we need to display hot trending topics?</li>
<li>Would there be any push notification for new (or important) tweets?</li>
</ul>

<h2 id="2-system-interface-definition" class="anchor-link"><a href="#2-system-interface-definition">2. System interface definition<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<p>è®¾è®¡APIï¼ŒæŠ½è±¡è½¯ä»¶åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">postTweet<span style="color:#f92672">(</span>user_id<span style="color:#f92672">,</span> tweet_data<span style="color:#f92672">,</span> tweet_location<span style="color:#f92672">,</span> user_location<span style="color:#f92672">,</span> timestamp<span style="color:#f92672">,</span> <span style="color:#960050;background-color:#1e0010">â€¦</span><span style="color:#f92672">)</span>

generateTimeline<span style="color:#f92672">(</span>user_id<span style="color:#f92672">,</span> current_time<span style="color:#f92672">,</span> user_location<span style="color:#f92672">,</span> <span style="color:#960050;background-color:#1e0010">â€¦</span><span style="color:#f92672">)</span>
</code></pre></div>
<h2 id="3-back-of-the-envelope-estimationç²—ç•¥ä¼°ç®—" class="anchor-link"><a href="#3-back-of-the-envelope-estimation%e7%b2%97%e7%95%a5%e4%bc%b0%e7%ae%97">3. Back-of-the-envelope estimation(ç²—ç•¥ä¼°ç®—)<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<p>ä¼°ç®—scale of the system, æ€è€ƒscaling, load balancing, caching, partitioning, etc</p>
<ul>
<li>What scale is expected from the system (e.g., number of new tweets, number of tweet views, how many timeline generations per sec., etc.)?</li>
<li>How much storage would we need? Weâ€™ll have different numbers if users can have photos and videos in their tweets.</li>
</ul>
<p>è¿™ä¸€éƒ¨åˆ†çš„ä¼°ç®—è¯¦è§<a href="http://www.1point3acres.com/bbs/thread-208829-1-1.html">æ­¤è´´</a></p>

<h2 id="4-defining-data-model" class="anchor-link"><a href="#4-defining-data-model">4. Defining data model<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<p>For Twitter, e.g.</p>
<p><strong>User</strong>: UserID, Name, Email, DoB, CreationData, LastLogin, etc.</p>
<p><strong>Tweet</strong>: TweetID, Content, TweetLocation, NumberOfLikes, TimeStamp, etc.</p>
<p><strong>UserFollowos</strong>: UserdID1, UserID2</p>
<p><strong>FavoriteTweets</strong>: UserID, TweetID, TimeStamp</p>

<h2 id="5-high-level-design" class="anchor-link"><a href="#5-high-level-design">5. High-level design<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<p>ç”»block diagramè®¾è®¡å›¾ã€‚</p>
<blockquote>
<p>For Twitter, at a high level, we would need multiple application servers to serve all the read/write requests with load balancers in front of them for traffic distributions. If weâ€™re assuming that weâ€™ll have a lot more read traffic (as compared to write), we can decide to have separate servers for handling these scenarios. On the backend, we need an efficient database that can store all the tweets and can support a huge number of reads. We would also need a distributed file storage system to store photos and videos.</p>
</blockquote>

<h2 id="6-detailed-design" class="anchor-link"><a href="#6-detailed-design">6. Detailed design<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<ul>
<li>Since weâ€™ll be storing a huge amount of data, how should we partition our data to distribute it to multiple databases? Should we try to store all the data of a user on the same database? What issue can it cause?</li>
<li>How would we handle hot users, who tweet a lot or follow a lot of people?</li>
<li>How much and at which layer should we introduce cache to speed things up?</li>
</ul>

<h2 id="7-bottlenecks" class="anchor-link"><a href="#7-bottlenecks">7. Bottlenecks<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<ul>
<li>Is there any single point of failure in our system? What are we doing to mitigate it?</li>
<li>Do weâ€™ve enough replicas of the data, so that if we lose a few servers, we can still serve our users?</li>
</ul>
<hr>

<h2 id="cap-theorem" class="anchor-link"><a href="#cap-theorem">CAP Theorem<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<p><a href="http://ksat.me/a-plain-english-introduction-to-cap-theorem/">A plain english introduction to CAP Theorem</a></p>
<ul>
<li>Consistency: æ‰€æœ‰èŠ‚ç‚¹è·å–æœ€æ–°æ•°æ®çš„èƒ½åŠ›</li>
<li>Availability: æ¯æ¬¡è¯·æ±‚éƒ½èƒ½è·å¾—å“åº”çš„èƒ½åŠ›ï¼ˆä¸ä¿è¯æœ€æ–°ï¼‰</li>
<li>Partitioning: åˆ†åŒºå®¹é”™æ€§ï¼Œåœ¨Cå’ŒAä¹‹é—´åšæŠ‰æ‹©</li>
</ul>
<hr>

<h2 id="key-concepts" class="anchor-link"><a href="#key-concepts">Key Concepts<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<p><strong>1. Horizontal vs Vertical Scaling</strong></p>
<ul>
<li>çºµå‘æ‰©å±• means increase the resources of a specific node, e.g. add additional memory to a server</li>
<li>æ¨ªå‘æ‰©å±• means increase the number of nodes, e.g. add additional servers thus decreasing the load on any one server</li>
</ul>
<p><strong>2. Load Balancer</strong>ï¼ˆè´Ÿè½½å‡è¡¡å™¨ï¼‰</p>
<p>é€šå¸¸åœ¨ä¸€ä¸ªscalable website çš„å‰ç«¯ä¼šæ”¾ç½®ä¸€ä¸ªload balancer, this allows a system to distribute the load evenly so that one server doesn&rsquo;t crash and take down the whole system</p>
<p><strong>3. Denormalization and NoSQL</strong></p>
<p>Denormalization means adding redundant information into a database to speed up reads</p>
<p><strong>4. Database Partitioning (Sharding)</strong></p>
<p>Sharding means split the data across multiple machines while ä½ ä»ç„¶çŸ¥é“å“ªäº›dataåœ¨å“ªäº›æœºå™¨ä¸Š</p>
<ul>
<li>Vertical Partitioning, partitioning by feature</li>
<li>Hash-based partitioning, using some part of the data (like an ID) to partition it. æ¯”å¦‚æœ‰Nä¸ªæœåŠ¡å™¨ï¼Œè®²æ•°æ®æ”¾åœ¨mod(key, n)å·æœåŠ¡å™¨ä¸Š</li>
<li>Directory-based partitioning, maintaining a look-up table for where the data can be found</li>
</ul>
<p><strong>5. Caching</strong></p>
<p>ç¼“å­˜ï¼Œç±»æ¯”LRU cache</p>
<p><strong>6. Asynchronous Processing (å¼‚æ­¥å¤„ç†)</strong></p>
<p>è€—æ—¶è¾ƒé•¿çš„slow operationæœ€å¥½be done asynchronously, å¦åˆ™ç”¨æˆ·å°†ä¼šè¢«é˜»å¡è¿‡é•¿æ—¶é—´ã€‚æœ‰æ—¶å¯ä»¥é€šè¿‡pre-processæ¥åŠ é€Ÿã€‚</p>
<p><strong>7. Networking metrics</strong></p>
<ul>
<li>Bandwidth: the maximum amount of data that can be transferred in a unit of time</li>
<li>Throughput: the actual amount of data that is transferred</li>
<li>Latency: This is how long it takes data to go from one end to the other</li>
</ul>
<p><strong>8. Read-heavy vs. Write-heavy</strong></p>
<p>Write-heavy: queuing up the writes (but think about the potential failure)</p>
<p>Read-heavy: cacheå¤§æ³•å¥½</p>
<hr>

<h2 id="example" class="anchor-link"><a href="#example">EXAMPLE<span class="pilcrow">&nbsp;Â¶</span></a></h2>
<p>è®¾è®¡Facebook, å®ç°find shortest path between two people çš„åŠŸèƒ½</p>
<p>Step1: ä¸è€ƒè™‘æ•°æ®è§„æ¨¡ï¼Œåˆ©ç”¨bidirectional-BFSæ‰¾ä¸¤äººä¹‹é—´æœ€çŸ­è·¯å¾„</p>
<p>Step 2: Scale up. å®ç°ä»¥ä¸‹æ¥å£ï¼Œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">int</span> machine_index <span style="color:#f92672">=</span> getMachineIDForUser<span style="color:#f92672">(</span>personID<span style="color:#f92672">);</span>

<span style="color:#75715e">//go to machine # machine_index
</span><span style="color:#75715e"></span>
Person friend <span style="color:#f92672">=</span> getPersonWithID<span style="color:#f92672">(</span>person_id<span style="color:#f92672">);</span>
</code></pre></div><p>é¦–å…ˆæ‰¾serverä¸­å­˜å‚¨personIDçš„æœºå™¨IDï¼Œå†ä»æœºå™¨ä¸­æ‰¾åˆ°å¯¹åº”çš„äºº</p>
<p>Step 3: Optimization.</p>
<ul>
<li>Reduce machine jumps: If 5 of my friends live on the same machine, I should look them up all at once</li>
<li>Smart division of people and machines. While dividing people across machines, try to divide them by country, city, state, and so on</li>
<li>&hellip;</li>
</ul></article>
        

        
        
        <nav role="navigation" class="flex-container bottom-menu">
            
<hr />
<p>


    

    
        
            <a href="/journal">ğŸ“</a>
        
    
    
        
            &#183; 
            <a href="/hack">ğŸ’¾</a>
        
            &#183; 
            <a href="/city">ğŸŒ‰</a>
        
            &#183; 
            <a href="/sea">ğŸŒŠ</a>
        
            &#183; 
            <a href="/mountain">ğŸ—»</a>
        
            &#183; 
            <a href="/bnw">ğŸ´â€â˜ ï¸</a>
        
            &#183; 
            <a href="/about">ğŸ‘¹</a>
        
    
    
    
        &#183; 
        <a href="/">
            home
        </a>
    

</p>
        </nav>
        
        
    </main>
    
    <footer class="flex-container footer">No more knowledge can be extracted from my telling
</footer>
    
    
</body>

</html>